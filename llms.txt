# ğŸ§¬ Clinical Raw Data Issue Tracker

[![R-CMD-check](https://github.com/Geomisgytree/rchk0/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/Geomisgytree/rchk0/actions/workflows/R-CMD-check.yaml)
[![tests](https://github.com/Geomisgytree/rchk0/actions/workflows/tests.yaml/badge.svg)](https://github.com/Geomisgytree/rchk0/actions/workflows/tests.yaml)
[![codecov](https://codecov.io/gh/Geomisgytree/rchk0/branch/main/graph/badge.svg)](https://app.codecov.io/gh/Geomisgytree/rchk0)
[![pkgdown](https://img.shields.io/badge/docs-pkgdown-blue.svg)](https://geomisgytree.github.io/rchk0/)
[![Lifecycle:
experimental](https://img.shields.io/badge/lifecycle-experimental-orange.svg)](https://lifecycle.r-lib.org/articles/stages.html)
[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

A spec-driven data validation platform designed for clinical trial
datasets. Built to help study leads automatically detect, track, and
resolve data issues across multiple raw data transfers. Modular,
extensible, and ready for deployment.

## ğŸ“Œ Features

- âœ… **Spec-Driven Configuration**: Study leads define all logic via
  Excel spec fileâ€”no coding required.
- ğŸ” **Automated Checkpoints**: Predefined and custom checks run across
  raw datasets.
- ğŸ“Š **Excel Output**: Issues are logged into structured Excel tabs with
  status tracking.
- ğŸ” **Multi-Run Support**: Handles repeated raw data transfers with
  versioned issue logs.
- ğŸ§  **Modular Architecture**: Easily extendable to new studies without
  changing core logic.
- ğŸ–¥ï¸ **Optional Shiny UI**: For non-technical users to run checks and
  view results interactively.

## ğŸ§ª Tech Stack

| Layer        | Tools Used                                 |
|--------------|--------------------------------------------|
| Language     | R (dplyr, openxlsx, purrr, haven, stringr) |
| Interface    | Shiny (optional)                           |
| Automation   | GitHub Actions (CI/CD), Docker (optional)  |
| Data Storage | Excel (current), SQLite (optional)         |
| Versioning   | Git + GitHub                               |

## ğŸ“ Project Structure

``` r
kiac-data-tracker/
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ .gitignore                 # å¿½ç•¥æ–‡ä»¶é…ç½®
â”œâ”€â”€ spec_template.xlsx         # é€šç”¨ spec æ¨¡æ¿ä¾› study lead ä½¿ç”¨
â”œâ”€â”€ config/                    # æ¯ä¸ª study çš„ spec æ–‡ä»¶
â”‚   â””â”€â”€ J3K-MC-KIAC_spec.xlsx
â”œâ”€â”€ sample_data/               # ç¤ºä¾‹ raw data å’Œ spec æ–‡ä»¶
â”‚   â”œâ”€â”€ demo_spec.xlsx
â”‚   â””â”€â”€ raw_data.sas7bdat
â”œâ”€â”€ driver/                    # ä¸» driver è„šæœ¬
â”‚   â””â”€â”€ run_tracker.R
â”œâ”€â”€ functions/                 # æ‰€æœ‰åŠŸèƒ½å‡½æ•°æ¨¡å—
â”‚   â”œâ”€â”€ preprocessing.R
â”‚   â”œâ”€â”€ checkpoints.R
â”‚   â”œâ”€â”€ excel_writer.R
â”‚   â””â”€â”€ utils.R
â”œâ”€â”€ shiny_ui/                  # å¯é€‰çš„ Shiny ç•Œé¢ä»£ç 
â”‚   â””â”€â”€ app.R
â”œâ”€â”€ tests/                     # å•å…ƒæµ‹è¯•è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ testthatï¼‰
â”‚   â””â”€â”€ test_checkpoints.R
â”œâ”€â”€ logs/                      # æ¯æ¬¡è¿è¡Œçš„æ—¥å¿—è®°å½•
â”‚   â””â”€â”€ run_log_20250920.txt
â”œâ”€â”€ output/                    # ç”Ÿæˆçš„ Excel è¾“å‡ºï¼ˆä¸çº³å…¥ Gitï¼‰
â””â”€â”€ .github/                   # GitHub Actions è‡ªåŠ¨åŒ–é…ç½®
    â””â”€â”€ workflows/
        â””â”€â”€ ci.yml             # CI/CD æµç¨‹å®šä¹‰
```

## ğŸš€ Quick Start

### 1. Clone the repository

``` bash
git clone https://github.com/yourusername/kiac-data-tracker.git
cd kiac-data-tracker
```

### 2. Install R dependencies

``` r
install.packages(c(
  "dplyr", "openxlsx", "haven", 
  "purrr", "stringr", "readxl"
))
```

### 3. Prepare your spec and raw data

- Use spec_template.xlsx as the starting point.
- Place your raw.sas7bdat files in a designated data folder.

### 4. Run the tracker

- The tracker generates an Excel file with multiple tabs:
  - ReadMe: Overview of the run and parameter settings
  - Issue Log: Cumulative issue tracking table
  - Dataset Tabs: Detailed issue records for each dataset

*Add screenshots or demo video links here to illustrate output.*

## ğŸ§  Design Philosophy

- Configuration over Code: All study-specific logic resides in the spec
  file.
- Modular Design: Each function is independently testable and reusable.
- User-Centric: Study leads can run checks without writing any code.
- Scalability: Supports versioned runs, state tracking, and new studies
  with minimal changes.

## ğŸ› ï¸ Future Plans

- Migrate core logic to Python (pandas + openpyxl).
- Replace Excel-based issue tracking with SQLite.
- Integrate an Airflow DAG for scheduled runs.
- Deploy the Shiny UI to RStudio Connect or Posit Workbench.
- Package the toolkit as an R library (kiacTracker).

## ğŸ‘¤ Author

**Shushun Ren**  
Statistical programmer / Biostatistician / Data Engineer Â· OMSCS
Candidate

ğŸ”— [LinkedIn](https://www.linkedin.com/in/shushunr/)  
ğŸ“§ <shushunr@umich.edu>

## ğŸ“† Change Log

| Version | Date       | Type    | Description                                                                      |
|---------|------------|---------|----------------------------------------------------------------------------------|
| v1.2.0  | 2025-08-27 | Added   | Driver, spec and raw data workflow setup, applied to KIAC, DSAF and DSAG studies |
| v1.1.0  | 2025-06-11 | Added   | Modularize functions and optimize workflows, driver program setup                |
| v1.0.0  | 2025-02-13 | Initial | Building checkpoints from scratch. Program setups                                |

# Package index

## All functions

- [`add_issue_meta()`](add_issue_meta.md) : Add issue metadata
- [`check_ED()`](check_ED.md) : Check ED visit consistency across
  datasets
- [`check_ds()`](check_ds.md) : Disposition Dataset Check
- [`check_ed_v801()`](check_ed_v801.md) : Check consistency between ED
  and V801 visits
- [`check_visit_discrepancy()`](check_visit_discrepancy.md) : Check
  visit discrepancies across EX/EC, SV, and TRTDSPN
- [`check_visit_gap()`](check_visit_gap.md) : Check visit gaps between
  consecutive visits
- [`compress_ranges()`](compress_ranges.md) : Compress consecutive
  integers into ranges
- [`compute_duplicate_visit_date()`](compute_duplicate_visit_date.md) :
  Check for duplicate visits with the same date
- [`compute_missing_key_vars()`](compute_missing_key_vars.md) : Check
  for missing key variables
- [`compute_visit_overlap()`](compute_visit_overlap.md) : Check for
  overlapped visits
- [`convert_dates_to_char()`](convert_dates_to_char.md) : Convert
  Date/POSIX columns in a data.frame to character
- [`format_issue_log_sheets()`](format_issue_log_sheets.md) : Format all
  issue log sheets in a workbook
- [`generate_spec()`](generate_spec.md) : Generate spec workbook (and
  optional YAML) for raw-data checks
- [`get_ed_dates()`](get_ed_dates.md) : Check for visits after ED
- [`load_dataset()`](load_dataset.md) : Load raw datasets into a named
  list, and also assign each to environment
- [`multi_site()`](multi_site.md) : Check subjects occurred in multiple
  sites
- [`preprocess()`](preprocess.md) : Preprocess raw datasets based on
  spec
- [`rchk0_reference`](rchk0_reference.md) : rchk0_reference
- [`run_tracker()`](run_tracker.md) : Run Raw Issue Tracker at one time
- [`sv_ds()`](sv_ds.md) : Check SV1001 visits not present in DS6001
- [`update_issue_log()`](update_issue_log.md) : Update issue log by
  merging new and old Excel sheets
- [`use_spec_builder_app()`](use_spec_builder_app.md) : Launch the Spec
  Builder App

# Articles

### All vignettes

- [Checkpoints Reference Guide](checkpoints.md):
- [getting-started](getting-started.md):
